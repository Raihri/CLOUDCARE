<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CloudCare â€” Login / Register</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600&display=swap"
        rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

    <style>
       :root {
    /* --- PRIMARY BRAND TONES --- */
    --primary-color: #1E3A8A;     /* Deep Medical Blue */
    --secondary-color: #3B82F6;   /* Soft bluish accent */

    /* --- NEUTRALS --- */
    --black: #0F172A;             /* Deep slate */
    --white: #ffffff;
    --gray: #F1F5F9;              /* Light bluish-gray */
    --gray-2: #64748B;            /* Cool medium gray */

    /* --- SOCIAL COLORS (unchanged or slightly tuned) --- */
    --facebook-color: #3B5998;
    --google-color: #DB4437;
    --twitter-color: #1DA1F2;
    --insta-color: #E1306C;
}


        * {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100vh;
            overflow: hidden;
        }

        .container {
            position: relative;
            min-height: 100vh;
            overflow: hidden;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            height: 100vh;
        }

        .col {
            width: 50%;
        }

        .align-items-center {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .form-wrapper {
            width: 100%;
            max-width: 28rem;
        }

        .form {
            padding: 1.5rem;
            background-color: var(--white);
            border-radius: 1.5rem;
            width: 100%;
            box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
            transform: scale(0);
            transition: .5s ease-in-out;
            transition-delay: 1s;
        }

        .input-group {
            position: relative;
            width: 100%;
            margin: 1.2rem 0;
            display: flex;
            align-items: center;
        }

        .input-group i {
            position: absolute;
            left: 1rem;
            font-size: 1.2rem;
            color: var(--gray-2);
            pointer-events: none;
        }

        .input-group input {
            width: 100%;
            padding: 0.9rem 1rem 0.9rem 2.8rem;
            font-size: 1rem;
            background-color: var(--gray);
            border-radius: .5rem;
            border: 1px solid #ccc;
            outline: none;
        }

        .input-group input::placeholder {
            color: var(--gray-2);
            opacity: 0.9;
        }

        .input-group input:focus {
            border-color: var(--primary-color);
        }

        .form button {
            cursor: pointer;
            width: 100%;
            padding: .6rem 0;
            border-radius: .5rem;
            border: none;
            background-color: var(--primary-color);
            color: var(--white);
            font-size: 1.2rem;
            outline: none;
            margin-top: 0.5rem;
        }

        .form p {
            margin: 1rem 0;
            font-size: .7rem;
        }

        .password-requirement {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #90a4ae;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .password-requirement i {
            font-size: 16px;
            flex-shrink: 0;
            min-width: 16px;
            color: #90a4ae;
            /* override .input-group i which sets absolute positioning */
            position: static !important;
            transform: none !important;
            left: auto !important;
            top: auto !important;
            margin-right: 6px;
        }

        .password-requirement.met i {
            color: #388e3c;
        }

        .password-requirement.met {
            color: #388e3c;
        }

        .flex-col {
            flex-direction: column;
        }

        .social-list {
            margin: 2rem 0;
            padding: 1rem;
            border-radius: 1.5rem;
            width: 100%;
            box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
            transform: scale(0);
            transition: .5s ease-in-out;
            transition-delay: 1.2s;
        }

        .social-list>div {
            color: var(--white);
            margin: 0 .5rem;
            padding: .7rem;
            cursor: pointer;
            border-radius: .5rem;
            cursor: pointer;
            transform: scale(0);
            transition: .5s ease-in-out;
        }

        .social-list>div:nth-child(1) {
            transition-delay: 1.4s;
        }

        .social-list>div:nth-child(2) {
            transition-delay: 1.6s;
        }

        .social-list>div:nth-child(3) {
            transition-delay: 1.8s;
        }

        .social-list>div:nth-child(4) {
            transition-delay: 2s;
        }

        .social-list>div>i {
            font-size: 1.5rem;
            transition: .4s ease-in-out;
        }

        .social-list>div:hover i {
            transform: scale(1.5);
        }

        .facebook-bg {
            background-color: var(--facebook-color);
        }

        .google-bg {
            background-color: var(--google-color);
        }

        .twitter-bg {
            background-color: var(--twitter-color);
        }

        .insta-bg {
            background-color: var(--insta-color);
        }

        .pointer {
            cursor: pointer;
        }

        .container.sign-in .form.sign-in,
        .container.sign-in .social-list.sign-in,
        .container.sign-in .social-list.sign-in>div,
        .container.sign-up .form.sign-up,
        .container.sign-up .social-list.sign-up,
        .container.sign-up .social-list.sign-up>div {
            transform: scale(1);
        }

        .content-row {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 6;
            width: 100%;
        }

        .text {
            margin: 4rem;
            color: var(--white);
        }

        .text h2 {
            font-size: 3.5rem;
            font-weight: 800;
            margin: 2rem 0;
            transition: 1s ease-in-out;
        }

        .text p {
            font-weight: 600;
            transition: 1s ease-in-out;
            transition-delay: .2s;
        }

        .img img {
            width: 30vw;
            transition: 1s ease-in-out;
            transition-delay: .4s;
        }

        .text.sign-in h2,
        .text.sign-in p,
        .img.sign-in img {
            transform: translateX(-250%);
        }

        .text.sign-up h2,
        .text.sign-up p,
        .img.sign-up img {
            transform: translateX(250%);
        }

        .container.sign-in .text.sign-in h2,
        .container.sign-in .text.sign-in p,
        .container.sign-in .img.sign-in img,
        .container.sign-up .text.sign-up h2,
        .container.sign-up .text.sign-up p,
        .container.sign-up .img.sign-up img {
            transform: translateX(0);
        }

        /* BACKGROUND */

        .container::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            height: 100vh;
            width: 300vw;
            transform: translate(35%, 0);
            background-image: linear-gradient(-45deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            transition: 1s ease-in-out;
            z-index: 6;
            box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
            border-bottom-right-radius: max(50vw, 50vh);
            border-top-left-radius: max(50vw, 50vh);
        }

        .container.sign-in::before {
            transform: translate(0, 0);
            right: 50%;
        }

        .container.sign-up::before {
            transform: translate(100%, 0);
            right: 50%;
        }

        /* RESPONSIVE */

        @media only screen and (max-width: 425px) {

            .container::before,
            .container.sign-in::before,
            .container.sign-up::before {
                height: 100vh;
                border-bottom-right-radius: 0;
                border-top-left-radius: 0;
                z-index: 0;
                transform: none;
                right: 0;
            }

            .container.sign-in .col.sign-in,
            .container.sign-up .col.sign-up {
                transform: translateY(0);
            }

            .content-row {
                align-items: flex-start !important;
            }

            .content-row .col {
                transform: translateY(0);
                background-color: unset;
            }

            .col {
                width: 100%;
                position: absolute;
                padding: 2rem;
                background-color: var(--white);
                border-top-left-radius: 2rem;
                border-top-right-radius: 2rem;
                transform: translateY(100%);
                transition: 1s ease-in-out;
            }

            .row {
                align-items: flex-end;
                justify-content: flex-end;
            }

            .form,
            .social-list {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }

            .text {
                margin: 0;
            }

            .text p {
                display: none;
            }

            .text h2 {
                margin: .5rem;
                font-size: 2rem;
            }
        }

        /* Container for all password rules */
        .password-requirements {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 8px;
        }

        /* Each individual rule */
        .password-requirement {
            display: flex;
            /* horizontal layout */
            flex-direction: row;
            /* ensure text & icon are side by side */
            align-items: center;
            /* vertically center icon & text */
            gap: 8px;
            /* space between icon & text */
            font-size: 14px;
            color: #6b7280;
            /* default gray */
        }

        /* Style for valid/invalid states */
        .password-requirement.valid {
            color: #16a34a;
            /* green */
        }

        .password-requirement.invalid {
            color: #9ca3af;
            /* light gray */
        }

        /* Icon inside each rule */
        .password-requirement i {
            font-size: 16px;
            display: inline-flex;
            /* make icon a flex item */
            align-items: center;
            /* vertical alignment */
            justify-content: center;
            line-height: 1;
            flex-shrink: 0;
            /* prevent icon from shrinking */
        }

        /* Optional: slightly nudge icons to center perfectly */
        .password-requirement i.bxs-check-circle {
            transform: translateY(1px);
            /* tweak for baseline differences in Boxicons */
        }
    </style>
</head>

<body>

    <div id="container" class="container sign-in">
        <div class="row">
            <!-- SIGN UP -->
            <div class="col align-items-center flex-col sign-up">
                <div class="form-wrapper align-items-center">
                    <form th:action="@{/patient/register}" method="post" class="form sign-up" th:object="${user}"
                        id="signupForm">
                        <div class="input-group">
                            <i class='bx bxs-id-card'></i>
                            <input type="text" th:field="*{name}" placeholder="Full name" required>
                        </div>
                        <div class="input-group">
                            <i class='bx bxs-user'></i>
                            <input type="text" th:field="*{username}" placeholder="Username" required>
                        </div>
                        <div class="input-group">
                            <i class='bx bx-mail-send'></i>
                            <input type="email" th:field="*{email}" placeholder="Email" required>
                        </div>

                        <div class="input-group" style="flex-direction:column;align-items:flex-start;">
                            <div style="width:100%;position:relative;">
                                <i class='bx bxs-lock-alt'
                                    style="position:absolute;left:1rem;top:50%;transform:translateY(-50%);"></i>
                                <input id="signupPassword" type="password" th:field="*{password}" placeholder="Password"
                                    required style="padding-left:2.8rem;width:100%;">
                            </div>
                            <div class="password-strength"
                                style="width:100%;margin-top:8px;display:flex;align-items:center;gap:12px;">
                                <div class="strength-bar"
                                    style="flex:1;height:8px;background:#e8e8e8;border-radius:4px;overflow:hidden;">
                                    <div id="signupStrengthFill"
                                        style="height:100%;width:0%;background:#4EA685;transition:width .3s ease;">
                                    </div>
                                </div>
                                <div id="signupStrengthText"
                                    style="min-width:70px;font-weight:600;color:#90a4ae;font-size:12px;">-</div>
                            </div>
                            <div id="signupRequirements"
                                style="margin-top:10px;padding:10px;background:#f5f5f5;border-radius:6px;display:none;font-size:13px;width:100%;">
                                <div id="sr-req-length" class="password-requirement"><i
                                        class='bx bx-circle'></i><span>At least 8 characters</span></div>
                                <div id="sr-req-uppercase" class="password-requirement"><i
                                        class='bx bx-circle'></i><span>One uppercase letter (A-Z)</span></div>
                                <div id="sr-req-lowercase" class="password-requirement"><i
                                        class='bx bx-circle'></i><span>One lowercase letter (a-z)</span></div>
                                <div id="sr-req-number" class="password-requirement"><i
                                        class='bx bx-circle'></i><span>One number (0-9)</span></div>
                                <div id="sr-req-special" class="password-requirement"><i
                                        class='bx bx-circle'></i><span>One special character (!@#$%^&*)</span></div>
                            </div>
                        </div>

                        <div class="input-group" style="flex-direction:column;align-items:flex-start;">
                            <div style="width:100%;position:relative;">
                                <i class='bx bxs-lock-alt'
                                    style="position:absolute;left:1rem;top:50%;transform:translateY(-50%);"></i>
                                <input id="signupConfirmPassword" type="password" name="confirmPassword"
                                    placeholder="Confirm password" required style="padding-left:2.8rem;width:100%;">
                            </div>
                            <div id="signupMatchMessage"
                                style="margin-top:8px;font-size:13px;display:none;font-weight:600;"></div>
                        </div>

                        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"
                            th:value="${_csrf.token}" />
                        <button type="submit" id="signupSubmit" disabled style="cursor:not-allowed;">Sign up</button>

                        <p>
                            <span>Already have an account?</span>
                            <b onclick="toggle()" class="pointer">Sign in here</b>
                        </p>

                        <p th:if="${errorMessage}" th:text="${errorMessage}" style="color:red;"></p>
                    </form>
                </div>
            </div>

            <!-- SIGN IN -->
            <div class="col align-items-center flex-col sign-in">
                <div class="form-wrapper align-items-center">
                    <form th:action="@{/patient/login}" method="post" class="form sign-in">
                        <div class="input-group">
                            <i class='bx bxs-user'></i>
                            <input type="text" name="email" placeholder="Email" required>
                        </div>
                        <div class="input-group">
                            <i class='bx bxs-lock-alt'></i>
                            <input type="password" name="password" placeholder="Password" required>
                        </div>

                        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"
                            th:value="${_csrf.token}" />
                        <button type="submit">Sign in</button>

                        <p><b><a th:href="@{/patient/forgot-password}">Forgot password?</a></b></p>
                        <p>
                            <span>Don't have an account?</span>
                            <b onclick="toggle()" class="pointer">Sign up here</b>
                        </p>

                        <p th:if="${param.error}" style="color:red;">Invalid email or password</p>
                        <p th:if="${error}" th:text="${error}" style="color:red;"></p>
                        <p th:if="${param.logout}" style="color:green;">You have been logged out</p>
                    </form>
                </div>

                <!-- Verification Form -->
                <div class="form-wrapper align-items-center" th:if="${param.registered}">
                    <form th:action="@{/patient/verify}" method="get" class="form">
                        <div class="input-group">
                            <i class='bx bx-check-circle'></i>
                            <input type="text" name="code" placeholder="Enter verification code" required>
                        </div>

                        <button type="button" id="sendOtpBtn" onclick="sendOtp()">Send OTP</button>
                        <p>Check your email for the verification code</p>
                    </form>
                </div>
            </div>
        </div>

        <!-- CONTENT ROW -->
        <div class="row content-row">
            <div class="col align-items-center flex-col">
                <div class="text sign-in">
                    <h2>CloudCare</h2>
                    <p>Sign in to continue</p>
                </div>
            </div>

            <div class="col align-items-center flex-col">
                <div class="text sign-up">
                    <h2>Join with us</h2>
                    <p>Fill-in your data</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const container = document.getElementById('container');
        function toggle() {
            container.classList.toggle('sign-in');
            container.classList.toggle('sign-up');
        }

        // Password strength & confirm logic for signup
        (function () {
            const pwd = document.getElementById('signupPassword');
            const cpwd = document.getElementById('signupConfirmPassword');
            const strengthFill = document.getElementById('signupStrengthFill');
            const strengthText = document.getElementById('signupStrengthText');
            const reqBox = document.getElementById('signupRequirements');
            const submitBtn = document.getElementById('signupSubmit');
            const matchMsg = document.getElementById('signupMatchMessage');

            if (!pwd) return; // signup form not present on some pages

            function scorePassword(p) {
                let score = 0;
                if (p.length >= 8) score += 1;
                if (/[A-Z]/.test(p)) score += 1;
                if (/[a-z]/.test(p)) score += 1;
                if (/[0-9]/.test(p)) score += 1;
                if (/[^A-Za-z0-9]/.test(p)) score += 1;
                return score; // 0..5
            }

            function updateStrength(p) {
                const s = scorePassword(p);
                const pct = Math.round((s / 5) * 100);
                strengthFill.style.width = pct + '%';
                if (s <= 1) { strengthText.textContent = 'Very Weak'; strengthFill.style.filter = 'grayscale(60%)'; }
                else if (s === 2) { strengthText.textContent = 'Weak'; strengthFill.style.filter = 'none'; }
                else if (s === 3) { strengthText.textContent = 'Fair'; }
                else if (s === 4) { strengthText.textContent = 'Good'; }
                else { strengthText.textContent = 'Strong'; }
            }

            function updateRequirements(p) {
                const checks = [
                    { id: 'sr-req-length', ok: p.length >= 8 },
                    { id: 'sr-req-uppercase', ok: /[A-Z]/.test(p) },
                    { id: 'sr-req-lowercase', ok: /[a-z]/.test(p) },
                    { id: 'sr-req-number', ok: /[0-9]/.test(p) },
                    { id: 'sr-req-special', ok: /[^A-Za-z0-9]/.test(p) }
                ];
                let anyVisible = false;
                checks.forEach(c => {
                    const el = document.getElementById(c.id);
                    if (!el) return;
                    anyVisible = true;
                    if (c.ok) {
                        el.classList.add('met');
                        el.querySelector('i').className = 'bx bxs-check-circle';
                    }
                    else {
                        el.classList.remove('met');
                        el.querySelector('i').className = 'bx bx-circle';
                    }
                });
                if (anyVisible) reqBox.style.display = p.length ? 'block' : 'none';
            }

            function checkMatch() {
                const a = pwd.value || '';
                const b = cpwd.value || '';
                if (!b) { matchMsg.style.display = 'none'; return false; }
                if (a === b) { matchMsg.style.display = 'block'; matchMsg.style.color = '#388e3c'; matchMsg.textContent = 'Passwords match'; return true; }
                else { matchMsg.style.display = 'block'; matchMsg.style.color = '#d32f2f'; matchMsg.textContent = "Passwords don't match"; return false; }
            }

            function updateSubmitState() {
                const p = pwd.value || '';
                const s = scorePassword(p);
                const meets = s === 5;
                const matches = checkMatch();
                if (meets && matches) { submitBtn.disabled = false; submitBtn.style.cursor = 'pointer'; submitBtn.style.opacity = 1; }
                else { submitBtn.disabled = true; submitBtn.style.cursor = 'not-allowed'; submitBtn.style.opacity = 0.6; }
            }

            pwd.addEventListener('input', function () {
                const v = pwd.value;
                updateStrength(v);
                updateRequirements(v);
                checkMatch();
                updateSubmitState();
            });

            cpwd.addEventListener('input', function () {
                checkMatch();
                updateSubmitState();
            });

            // Basic prevention: ensure passwords validated client-side before submit
            const form = document.getElementById('signupForm');
            form && form.addEventListener('submit', function (e) {
                const p = pwd.value || '';
                if (scorePassword(p) < 5 || !checkMatch()) {
                    e.preventDefault();
                    alert('Please ensure your password meets all requirements and both fields match.');
                    return;
                }
                // Disable submit button after first click to prevent multiple submissions
                submitBtn.disabled = true;
                submitBtn.style.opacity = 0.5;
                submitBtn.style.cursor = 'not-allowed';
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Signing up...';
            });
        })();
        function sendOtp() {
            const btn = document.getElementById("sendOtpBtn");

            // Disable button to prevent double click
            btn.disabled = true;
            btn.innerText = "Sending...";

            fetch("/send-otp", { method: "POST" })
                .then(response => response.json())
                .then(data => {
                    btn.innerText = "OTP Sent";
                })
                .catch(err => {
                    btn.disabled = false; // Re-enable if error
                    btn.innerText = "Send OTP";
                });
        }

    </script>

</body>

</html>